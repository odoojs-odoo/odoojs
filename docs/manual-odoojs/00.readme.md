### odoojs 介绍

1. 依赖 odoorpc
2. 集成 odoorpc 的所有功能
3. 扩展 action, view, viewmodel
4. 可继承 action, 对已有 action 进行补充
5. 继承 action, 自定义新的 action 功能, 将来计划补充

### odoojs 基本使用方法

#### 集成 odoorpc 的所有功能

```
import { ODOO as ODOORPC } from '@/odoorpc'
import { ODOO as ODOOJS } from '@/odoojs'
const baseURL = 'http://your_odoo_server:8069'
const api = new ODOOJS({ baseURL, ODOORPC })

const test_connect_odoo = async ()=>{
    const version_info = await api.get_version_info()
    console.log( version_info )
}

const test_login = async ()=>{
    const db = 'your_database_name'
    const login = 'your_user_name'
    const password = 'your_password'
    const result = await api.login({db, login, password})
    console.log( result )
    const session_info = api.session_info
    console.log( result )
}

const test_model = async ()=>{
    const model_name = 'res.partner'
    const Partner_Model = api.env.model(model_name)
    const result = await Partner_Model.search([], {limit:10})
}

```

1. 下载 odoorpc, 复制到自己的项目中
2. 下载 odoojs, 复制到自己的项目中
3. odoojs 依赖 odoorpc, 正确配置 odoorpc 和 odoojs 的路径
4. baseURL 定义 服务器的地址
5. 导入 odoorpc 中的 ODOO 类
6. 导入 odoojs 中的 ODOO 类
7. 创建 服务器连接 api
8. api 是一个对象, 是 odoojs 的使用入口
9. 与 odoorpc 一样, 可以直接使用 login, env, 以及各种 模型方法

#### action 获取

```
const test_action_with_xml_id = async () {
    const action_xml_id = 'contacts.action_contacts'
    const action = await api.action(action_xml_id)
    console.log(action)
    console.log(action.env.context, action.domain)
}

const test_action_with_id = async () {
    const action_xml_id = 'contacts.action_contacts'
    const action_ref = await api.env.ref(action_xml_id)
    const action_id = action_ref.id
    const action = await api.action(action_id)
    console.log(action)
    console.log(action.env.context, action.domain)
}
```

1. api.action 是一个异步方法
2. 参数是 action_xml_id 或者 action_id
3. action 是一个对象, 后续使用 action 进一步使用其中的 view 及 viewmodel

#### 使用 listview 及 viewmodel

```
const test_listviewmodel = async () {
    const action_xml_id = 'contacts.action_contacts'
    const action = await api.action(action_xml_id)

    const listview = action.listview
    const model = listview.model
    const dataList1 = await model.pageGoto(1)
    const dataList2 = model.values_list
    const total_length = model.total_length
    const page_count = model.page_count
    const page_number = model.page_number
    console.log(dataList1)
    console.log(dataList2)

    console.log(total_length, page_count, page_number)
}

```

1. action.listview 获取 该 action 中的 list view 视图
2. model = action.listview.model 获取 该 list view 的 viewmodel
3. model 是一个对象, 对数据操作的所有接口 通过 model 对象
4. model.pageGoto(1) 是 数据查询接口. 依据该 action 定义的查询条件, 字段信息, 获取相应数据
5. model.pageGoto 的参数 是当前页号, 默认第一页
6. model.values_list 查询结果为数组, 暂存在该变量中
7. dataList1 和 dataList2 是相同的
8. model.total_length 是 总数据记录数
9. model.page_count 是总页数
10. model.page_number 是当前页号
11. values_list 可用于页面展示数据
12. total_length, page_count, page_number, 可用于页面翻页控制

#### 使用 formview 及 viewmodel

```
const test_formviewmodel = async () {
    const action_xml_id = 'contacts.action_contacts'
    const action = await api.action(action_xml_id)
    const listview = action.listview
    const listmodel = listview.model
    const dataList = await listmodel.pageGoto(1)

    const formview = action.formview
    const model = formview.model
    const rid = dataList[0].id

    const dataDict1 = await model.read(rid)
    const dataDict2 = model.values

    console.log(dataDict1)
    console.log(dataDict2)
}

```

1. action.formview 获取 该 action 中的 form view 视图
2. model = action.formview.model 获取 该 form view 的 viewmodel
3. model 是一个对象, 对数据操作的所有接口 通过 model 对象
4. model.read(rid) 是 数据查询接口. 依据该 action 中定义的字段信息, 获取相应数据
5. model.values 查询结果为对象, 暂存在该变量中
6. dataDict1 和 dataDict1 是相同的
7. values 可用于页面展示数据

#### 读取 one2many 字段的数据

1. 待完善

#### 编辑 删除 新增操作

1. 待完善
