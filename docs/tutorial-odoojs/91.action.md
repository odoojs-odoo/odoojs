### 读取 数据流程

1. 已知 action_xml_id
2. 访问 model='ir.model.data', method='xmlid_to_res_model_res_id', 获得 action_id
3. 访问 url='/web/action/load', 获取 action 信息
4. action 信息中包括 res_model, domain, context, views 等
5. 访问 model=res_model, method='loadview', 获取 views 信息
6. views 信息中包括, list, form 等 view 视图 的 fields 和 arch
7. 访问 model=res_model, method='web_search_read', 获取 listview 展示需要的数据
8. 在 listview 展示页面中, 点击一行, 获取该行的 id
9. 访问 model=res_model, method='read', 获取 formview 展示需要的数据
10. 编辑 formview 中的数据, 触发 onchange 方法
11. 访问 model=res_model, method='onchange', 获取 其他字段更新后的值
12. 更新 formview 展示的数据
13. 访问 model=res_model, method='write', 更新数据到服务器
14. 访问 model=res_model, method='read', 获取 获取更新后的数据
15. 新增时, 与编辑雷同
16. 访问 model=res_model, method='default_get', 获取 formview 页面展示的默认值
17. 编辑 formview 中的数据, 触发 onchange 方法
18. 访问 model=res_model, method='create', 创建数据到服务器
19. 删除记录, 选中 要删除的记录 id
20. 访问 model=res_model, method='unlink', 删除数据，提交到服务器
21. 访问 model=res_model, method='web_search_read', 更新 listview 中的数据

### 几个重要参数

1. 所有的模型方法,都需要 context 参数, 来自于 action load 的返回结果
2. web_search_read 需要 domain, 来自于 action load 的返回结果
3. web_search_read, read, default_get 方法需要 fields, 来自于 load view 的返回结果
4. onchange 需要 values, field_onchange 参数, values 来自页面编辑内容, field_onchange 来自 load view 的返回结果

### 获取 action

```
    const action_xml_id = 'contacts.action_contacts'
    const action = await api.action(action_xml_id)
    console.log(action.env.context, action.domain)
```

1. action_xml_id 是入口, 打开一个页面时, 必须提供 action_xml_id
2. 不同的 action_xml_id, 打开不同的 功能页面
3. 示例中的 action_xml_id, 对应 "更多联系人" 菜单的 action
4. api 变量参看前几节的内容, 是我们调用 网络请求的入口
5. api.env 是一个对象, 用于管理模型
6. api.env.action 是一个异步方法, 将执行 action load 和 load view 两次 请求
7. action 变量是一个对象, 后续操作 action 中的 view, 用这个 action 对象
8. 示例代码中 打印了 action.env.context, action.domain
9. 后续 代码中 用的 context 和 domain 参数, 在这里暂存
10. context 和 domain 都是 字符串类型, 后续模型方法中 使用前, 需要转换 为对象
11. context 和 domain 的字符串是 python 语法的表达式
12. api.env 中有方法, 将这种 字符串转换为 前端 javascript 对象

### 获取 listview 数据

```
    const action_xml_id = 'base.action_country'
    const action = await this.api.env.action(action_xml_id)
    const listview = action.listview
    const model2 = listview.model
    const model = model2.with_context({ lang: 'en_US' })
    model.domain = [...model.domain]
    console.log('domain,order,limit:', model.domain, model.order, model.limit)
    const dataList = await model.pageGoto(1)
    console.log(model.total_length, model.page_count, model.page_number)
    console.log('dataList:', dataList)
```

1. base.action_country 对应 国家的 action
2. action.listview 是 一个对象, 管理 listview 页面
3. action.listview.model 是 一个对象, 管理 listview 页面 的数据
4. with_context 方法, 允许 我们修改 context 信息, 本例要求返回英文数据. (默认是当前登陆用户的语言)
5. model.domain 里是 查询的过滤条件, 如果需要额外的过滤条件, 请暂存原值后, 再修改 model.domain
6. model.domain 修改后, 原值就丢失了. (以后, 我会增加一个变量, 保存原值)
7. model.pageGoto 是一个异步函数, 将访问 web_search_read 方法
8. model.total_length, model.page_count, model.page_number 中的数据可用于分页控制
9. model.dataList 是列表数据, 可以用于 页面展示

### 获取 formview 数据

```
    const action_xml_id = 'contacts.action_contacts'
    const action = await this.api.env.action(action_xml_id)
    const listview = action.listview
    const dataList = await listview.model.pageGoto(1)
    console.log(dataList)
    const rid = dataList[2].id
    const formview = action.formview
    const dataDict = await formview.model.read(rid)
    console.log(dataDict)

```

1. contacts.action_contacts 对应 更多联系人 action
2. dataList 为 listview 的数据
3. dataList[2].id 这是 模拟 页面选中行操作, 选中第三行
4. action.formview 是 一个对象, 管理 formview 页面
5. action.formview.model 是 一个对象, 管理 formview 页面 的数据
6. formview.model.read 是一个异步函数, 将访问 模型的 read 方法
7. dataDict 是一个对象, formview 页面 的数据, 可用户 页面展示

### formview 页面 one2many 字段数据的读取

```
    const action_xml_id = 'base.action_country'
    const action = await this.api.env.action(action_xml_id)
    const listview = action.listview
    const dataList = await listview.model.pageGoto(1)
    console.log(dataList)
    const rid = dataList[3].id
    const formview = action.formview
    const model = formview.model
    await model.read(rid)
    console.log(model.values)
    await model.relation_browse('state_ids')
    console.log(model.values)

```

1. base.action_country 对应 国家的 action
2. formview.model.read 刷新 页面数据
3. formview.model.values 是 一个对象, 可用于 formview 页面 的数据展示
4. formview.model.relation_browse('state_ids'), 刷新 one2many 字段的数据
5. formview.model.values 再次读取 这里数据, 相比 上次 state_ids 字段的数据已经刷新

### formview 编辑 删除 新增

1. 这些内容放在下节
