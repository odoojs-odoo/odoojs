## 课程目标

1. 掌握 odoo 的 JsonRpc 接口基本要求
2. 掌握 vue 前端项目如何访问 odoo 接口

## 课程进程

1. 准备工作, 创建 vue 项目
2. 启动 odoo 服务
3. 查看 odoo 源码
4. 测试 odoo 可以访问
5. 了解 浏览器开发者工具
6. 连接 odoo, 解决跨域
7. 查看请求和响应
8. 解释几个关键点: 异步, header, JsonRpc 协议, 参数, 返回结果
9. 渲染页面
10. 使用 axios. 简化代码
11. 使用 odoorpc. 简化代码
12. 总结本节的关键点. odoo 前后端分离, 自己做自己的 erp 产品, odoojs 的作用和价值

## 课程内容

### 准备工作

#### 创建 vue 项目

1. [参考文档](https://gitee.com/odoowww/odoojs/blob/master/docs/tutorial/00.create.project.md)
2. 在 [码云](https://gitee.com/) 新建仓库, 注意不要初始化仓库
3. [创建 vue 项目](https://cli.vuejs.org/zh/guide/creating-a-project.html)
4. 运行项目

```
vue create odoojs-open
cd odoojs-open
git remote add origin https://gitee.com/<your-git-account>/<your-git-project>.git
git push -u origin master
tyarn
tyarn serve
```

#### 简单介绍下 vue 项目的结构

1. main.js
2. app.vue
3. components/HelloWorld.vue

#### 新建一个页面 Test0.vue 替换 HelloWorld.vue

1. 复制 HelloWorld.vue 命名为 Test0.vue
2. 修改 Test0.vue, 删除无关内容
3. 修改 App.vue 引入 Test0.vue
4. 运行项目, 查看效果

### 准备服务器

#### 启动服务端

1. 启动服务端
2. 查看 odoo 运行日志
3. 登录 8069 端口, 查看 odoo
4. 查看 odoo 服务端版本号
5. 运行日志第一行 显示 odoo 版本号
6. odoo 菜单->设置->关于. 显示版本号

#### 查看 odoo 源码

1. odoo.addons.web.main.py
2. WebClient.version_info

```
class WebClient(http.Controller):
    @http.route('/web/webclient/version_info', type='json', auth="none")
    def version_info(self):
        pass
```

#### 测试 odoo

1. 创建一个 html 文件. 内容如下
2. 修改其中的 ip 地址为你的 odoo 服务器地址
3. 浏览器中打开该文件
4. 打开浏览器开发者工具. 查看情况
5. 在服务端查看日志输出
6. 提示跨越, 说明, 浏览器与服务端已经请求响应成功.

```
<script type="text/javascript">
  const xml = new XMLHttpRequest()
  const url = 'http://192.168.56.108:8069/web/webclient/version_info'
  xml.open('POST', url, true)
  xml.send()
</script>

```

### 浏览器开发者工具

#### 打开 开发者工具

1. google chrome. 右上角菜单 -> 更多工具 -> 开发者工具 -> network
2. firefox . 右上角菜单 -> 更多工具 -> web 开发者工具 -> 网络 network
3. safari . 菜单 -> 开发 -> 显示页面检查器
4. 右键菜单 -> 检查 -> network

### 修改 Test0.vue, 测试请求

1. 添加按钮.
2. 按钮点击事件
3. 使用 XMLHttpRequest 发送请求
4. 确认服务端有响应. 看到跨域提示
5. 配置代理, 解决跨越
6. 请求成功
7. 代码规整为一个异步函数. 返回响应结果
8. 处理响应结果. 在页面上显示

```
    async request_version_info1() {
      const baseURL = process.env.VUE_APP_BASE_API
      const requst = new XMLHttpRequest()
      const url = baseURL + '/web/webclient/version_info'
      requst.open('POST', url, true)
      requst.setRequestHeader('Content-type', 'application/json')
      const data = {
        jsonrpc: '2.0',
        method: 'call',
        params: {},
        id: 1
      }
      const data2 = JSON.stringify(data)
      // requst.send('{"jsonrpc": "2.0", "method": "call", "params": {}, "id": 1}')
      requst.send(data2)
      const res = new Promise(resolve => {
        setTimeout(() => {
          const res = requst.response
          const res2 = JSON.parse(res)
          resolve(res2)
        }, 500)
      })
      return res
    }

```

### 使用 axios

1. 安装 axios
2. 修改 按钮点击事件 函数. 使用 axios 发送请求
3. 对比 与 XMLHttpRequest 的异同

```
import axios from 'axios'

export default {
  methods: {
    async request(url, params) {
      const baseURL = process.env.VUE_APP_BASE_API
      const timeout = 50000
      const service = axios.create({ baseURL, timeout })

      const data = {
        params: params,
        jsonrpc: '2.0',
        method: 'call',
        id: Math.floor(Math.random() * 1000000000 + 1)
      }

      const response = await service({ url, method: 'post', data })
      return response.data.result
    },

    async onclick() {
      const url = '/web/webclient/version_info'
      const result = await this.request(url, {})
      console.log('onlick', result)
      this.result = result
    }
  }
}

```

### 使用 odoorpc

1. 复制 odoorpc 到项目中.
2. 依赖 axios. 需要安装 axios
3. 调用异步函数, 获取 odoo 版本号
4. 在页面上显示 odoo 版本号

```
import api from '@/odoorpc'
const baseURL = process.env.VUE_APP_BASE_API
const timeout = 50000
api.init({ baseURL, timeout })

export default {
  data() {
    return {
      result: {}
    }
  },
  methods: {
    async onclick() {
      const result = await api.web.webclient.version_info()
      console.log('onlick', result)
      this.result = result
    }
  }
}
```

### 总结

1. odoo 是完美的 erp 服务端平台
2. odoo 的前端. 用于后台管理, 足够优秀.
3. odoo 的前端. 用于前台管理. 个性化的需要更多一些.
4. odoo 的前后端 是可以分离的
5. 用 odoo 实现业务管理. 在前后端分离的基础上, 开发前端. 相当于自己做自己的 erp 平台
6. erp 终端用户,(指使用 erp 平台的企业). 有条件去打造自己的 erp
7. erp 实施服务团队,( 指广大的 odoo 实施开发人员/团队/公司), 有条件为客户提供更多个性化的服务
8. 以后的方向, 低代码开发

### 关于 odoojs

1. odoojs 不是一个新造的东西.
2. odoojs 是前端代码的一部分. 简化前端开发工作, 提高前端开发效率.
3. odoojs 包括 odoorpc / odooapi / odooweb 三部分的内容.今天用到了 odoorpc

### 做自己的 ERP 系统

#### erp 使用者视角

1. 一般来讲，企业需要 erp 系统，都是购买
2. 个别也有自行开发的，通常，成本支出与预期效果不成比例
3. erp 系统，又是企业的核心业务系统，与企业的管理流程密切相关，体现企业自己的管理理念。
4. 站在企业角度看问题，通用的 erp 系统，无法融合企业自己的管理思想。
5. 非大型企业，不具备自行开发 erp 系统的客观条件。
6. odoo 官方系统本身就是面向中小企业，易于定制开发的 erp 平台。
   在业务层面，为企业提供了自行开发 erp 系统的可能。
7. odoo 官方前端部分，个性化部分自由度不高。与市面上常见的前端开发思路不太吻合。
8. odoojs 实现了 odoo 的前后端分离。
9. 用 odoo 服务端. 可以快捷方便的做 erp 系统的开发. 实现个性化的 erp 业务流程.
10. 基于 odoojs, 自行开发 erp 前端部分. 100% 完全的自由定制.
11. 对开发者的技术要求, 仅限于前端技术, H5, 小程序, APP.
12. 业务人员与开发人员之间的交流互动, 更容易.

#### erp 开发实施者视角

1. erp 开发者, 多数是 erp 实施顾问, python 程序员.
2. 长于后端开发. 对前端了解不多.
3. 前后端开发技术, 技术特点差异有点大. 同时掌握这两类技术, 不太容易
4. 使用 odoo 平台, 在模块开发方面, 驾轻就熟.
   而在 odoo 前端部分, 只限于 odoo 提供的模版, 无法发挥.
5. odoo 前后端分离. 将前端部分的开发, 交给前端程序员去完成.

#### 前端工程师视角

1. UI, UE, H5, 小程序, APP, VUE, React, uniapp, HBuider 是前端常见的技术术语.
2. odoo 实施开发需要 前端工程师.
3. odoo 需要的前端工程师. 与前端工程师常规掌握的技术匹配度很低.
4. 很少有前端工程师, 转为 odoo 实施开发工程师. 除非去了解 odoo 模块开发.
   实际上这已经 转为了 odoo 开发工程师
5. odoo 前后端分离. 让前端开发更专业.
6. 前端工程师, 不再需要过度关心 odoo 模块开发的事. 可以更专注到前端的实现上.
7. 前端工程师, 已经掌握的 UI, UE, H5, VUE 等技术 更易于发挥.
   进入 odoo/ erp 实施领域的门槛大大降低.
8. 更多的成熟的前端工程师, 有意愿加入到 erp 实施 这个大家庭.

### 视频地址

[odoojs 公开课 1 视频地址]https://www.bilibili.com/video/BV1eR4y1L7W1/)

### 请作者喝杯咖啡

如果你觉得课程不错. 请作者喝杯咖啡.

![请作者喝杯咖啡](https://gitee.com/odoowww/odoojs/raw/master/docs/image/12.jpg)
