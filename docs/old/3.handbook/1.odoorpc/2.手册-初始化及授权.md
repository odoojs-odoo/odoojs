## odoorpc 基本使用方法

### odoorpc 的初始化

```
import api from '@/odoorpc'
const baseURL = 'http://your_odoo_server:8069'
const timeout = 50000
api.init({ baseURL, timeout })
```

### 测试连接 odoo, 获取 odoo 版本信息

##### 调用接口

1. 确保在其他地方已经完成初始化.
   使用 odoorpc 之前, 必须先初始化. 初始化只需要一次即可.
   其他接口的调用, 不再重复强调 必须先初始化.
2. 导入 odoorpc
3. 调用异步接口函数, 发送请求, 返回数据

```
import api from '@/odoorpc'
const test_connect_odoo = async ()=>{
    const version_info = await api.web.webclient.version_info()
    console.log( version_info )
}

```

##### 返回结果

```
{
    server_version: '14.0-20210908',
    server_version_info: [14, 0, 0, 'final', 0, ''],
    server_serie: '14.0',
    protocol_version: 1
}
```

### 登录 odoo, 验证授权. web.session.authenticate

##### 调用接口

1. 接口: api.web.session.authenticate
2. 参数: db, login, password
3. 返回: session 信息, 参见 session 部分
4. 如果授权验证不通过, 抛出异常, 可以通过 try catch 捕捉异常. 查看验证不通过的原因
5. 在响应头中, 携带 cookie. cookie 中包含 session_id

```
import api from '@/odoorpc'
const test_authenticate = async ()=>{
    const db = 'your_database_name'
    const login = 'your_user_name'
    const password = 'your_password'
    const session_info = await api.web.session.authenticate({db, login, password})
    console.log( session_info )
}

```

### 获取 session 信息. web.session.get_session_info

##### 调用接口

1. 接口: api.web.session.get_session_info
2. 参数: 无
3. 返回: session 信息, 参见 session 部分
4. 如果 session 失效, 抛出异常, 可以通过 try catch 捕捉异常. 查看验证不通过的原因
5. 在响应头中, 携带 cookie. cookie 中包含 session_id

```
import api from '@/odoorpc'
const test_get_session_info = async ()=>{
    const session_info = await api.web.session.get_session_info()
    console.log( session_info )
}

```

### 检查当前 session 是否有效. web.session.check

##### 调用接口

1. 接口: api.web.session.check
2. 参数: 无
3. 返回: 无

```
import api from '@/odoorpc'
const test_check = async ()=>{
    await api.web.session.check()
}
```

### 注销. web.session.destroy

##### 调用接口

1. 接口: api.web.session.destroy
2. 参数: 无
3. 返回: 无

```
import api from '@/odoorpc'
const test_destroy = async ()=>{
    await api.web.session.destroy()
}
```

### 修改密码. web.session.change_password

##### 调用接口

1. 接口: api.web.session.change_password
2. 参数: fields = [
   { name: 'old_pwd', value: 'old_pwd' },
   { name: 'new_password', value: 'new_password' },
   { name: 'confirm_pwd', value: 'new_password' }
   ]
3. 返回: {'new_password':'new_password'}
4. 如果 session 失效, 抛出异常, 可以通过 try catch 捕捉异常. 查看验证不通过的原因

```
import api from '@/odoorpc'
const test_change_password = async ()=>{
    fields = [
        { name: 'old_pwd', value: 'old_pwd' },
        { name: 'new_password', value: 'new_password' },
        { name: 'confirm_pwd', value: 'new_password' }
    ]
    const res = await api.web.session.change_password({fields})
    console.log( res )
}

```

##### 返回结果

```
{
  'new_password':'new_password'
}
```
